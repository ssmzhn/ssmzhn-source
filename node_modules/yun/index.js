#!/usr/bin/env node
/**
 * @author human.hjh
 * @created 15/9/14
 */

var exec = require('child_process').exec,
	watchDoc = require('./src/watchDoc'),
	server = require('./src/server');
	//koa = require('koa'),
	//staticCache = require('koa-static-cache');

var userPath = process.cwd();

var program = require('commander'),
	color = require('colorful'),
	package = require('./package.json');

program
	.version(package.version)
	.option('-p, --port [int]', 'Use specify port')
	.parse(process.argv);


var firstArgs = program.args[0];

var port = 3000;

if (firstArgs == 'start') {
	if (program.port) {
		port = parseInt(program.port);
	}

	server.start(port);
	watchDoc.start();

	// ========= Static Web ========
	//var app = koa();
      //
	//app.use(staticCache(userPath));
	//app.listen(3001);
	//console.log('Document Listening at localhost:3001/build/README.html');
	// =============================

}
else if (firstArgs == 'init') {
	var cpStr = 'cp -r '+ __dirname +'/template/* ' + userPath + '/';
	var child = exec(cpStr,
		function (error, stdout, stderr) {
			if (error == null) {
				console.log('Generated Done. Please execute: npm install.')
			}
		});
}
else {

	console.log('\nWelcome to use '+ color.magenta('yun') + ' ' + package.version);

	console.log('Examples:');
	console.log('    yun init');
	console.log('    yun start');
	console.log('    yun start --port 3000');
	console.log('');
	console.log('for more info => Aliwangwang Group: 1421163385');
	console.log('');

}
