/**
 * @author human.hjh
 * @created 15/9/15
 */

var path = require('path');
var fs = require('fs');
var gulp = require('gulp');
var marked = require('marked');

module.exports.start = function() {

	var userPath = process.cwd();
	var package = require(userPath + '/package.json');

	gulp.task('build_doc', function() {
		var readmeContent, layoutContent, pResultContent;

		readmeContent = fs.readFileSync(userPath + '/README.md').toString();
		layoutContent = fs.readFileSync(path.join(__dirname, './layout/layout.html')).toString();


		pResultContent = layoutContent.replace('{{ content }}', marked( readmeContent ));
		pResultContent = pResultContent.replace('{{ title }}', package.name);

		fs.writeFileSync(userPath + '/index.html', pResultContent);

		console.log('README(Markdown) Generated!');
	});

	gulp.watch(userPath + '/README.md', ['build_doc']);
	gulp.run(['build_doc']);
};